<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matka 69</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/css/headerlogin.css" />
    <link rel="stylesheet" href="/css/bets.css" />
    <link rel="stylesheet" href="/css/slider.css" />
    <link rel="stylesheet" href="/css/footer.css" />
    <link rel="stylesheet" href="/css/dateTimemodal.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/rendomsidebar.js"></script>
    <script src="/js/footer.js"></script>
    <script src="/js/betshistry.js"></script>
     <!-- <script src="js/dateTimemodal.js"> </script> -->
  </head>

  <body>
    <!-- ==================================================Header======================================= -->

    <%- include('partials/header') %>
    <div class="header"></div>
    <!-- ========================= overflow header solve -->

    <!-- +++++++++++++++++++++++++++  Slider Banner +++++++++++++++++++++++ -->
    <div class="mbanner">
      <div class="mx-auto">
        <!-- Banner Wrapper -->
        <div class="banner-container shadow-3xl">
          <!-- Slide 1 -->
          <div class="banner-slide active" data-index="0">
            <img
              src="images/egaming1.png"
              class="w-full h-full object-cover"
              alt="Placeholder Image 1: Feature A"
            />
          </div>

          <!-- Slide 2 -->
          <div class="banner-slide" data-index="1">
            <img
              src="images/egaming2.png"
              class="w-full h-full object-cover"
              alt="Placeholder Image 2: Feature B"
            />
          </div>

          <!-- Slide 3 -->
          <div class="banner-slide" data-index="2">
            <img
              src="images/egaming3.png"
              class="w-full h-full object-cover"
              alt="Placeholder Image 3: Feature C"
            />
          </div>

          <!-- Navigation Buttons -->
          <div
            class="absolute inset-0 flex items-center justify-between p-4 z-20"
          >
            <button
              id="prevBtn"
              class="transition shadow-lg opacity-70 hover:opacity-100 disabled:opacity-30 disabled:cursor-not-allowed"
            ></button>
            <button
              id="nextBtn"
              class="transition shadow-lg opacity-70 hover:opacity-100 disabled:opacity-30 disabled:cursor-not-allowed"
            ></button>
          </div>
        </div>

        <!-- Pagination Dots -->
        <div id="pagination" class="flex justify-center space-x-2 mt-4">
          <!-- Dots will be generated here by JS -->
        </div>
      </div>
    </div>

    <!-- +++++++++++++++++++++++++++ body start +++++++++++++++++++++++ -->
<div class="form-container">

  <!-- Data Source Dropdown -->
  <select class="custom-input text-gray-600" id="dataSource">
    <option value="" disabled <%= !source ? "selected" : "" %>>Data Source</option>
    <option value="live"   <%= source === "live" ? "selected" : "" %>>Live Data (24H)</option>
    <option value="backup" <%= source === "backup" ? "selected" : "" %>>Backup Data (7 Days)</option>
    <option value="old"    <%= source === "old" ? "selected" : "" %>>Old Data (30 Days)</option>
  </select>

<input type="date" class="custom-input" id="startDate"
  data-placeholder="Start Date"
  value="<%= start || '' %>">

<input type="date" class="custom-input" id="endDate"
  data-placeholder="End Date"
  value="<%= end || '' %>">


  <!-- Button -->
  <button class="btn-history" onclick="getHistory()">
    Get History
  </button>
</div>



    <div class="tab-container" role="tablist" aria-label="Example tabs">
      <div class="tab active" id="unsettledTab" role="tab" aria-selected="true">
        Unsettled
      </div>
      <div class="tab" id="settledTab" role="tab" aria-selected="false">
        Settled
      </div>
    </div>

    <div
      id="unsettledSection"
      class="section active"
      role="tabpanel"
      aria-labelledby="unsettledTab"
    >
      <div class="scroll-wrapper">
        <div
          class="scroll-row"
          style="display: flex; justify-content: space-between; gap: 10px"
        >
          <!-- S.No -->
          <ol class="col" style="flex: 1; text-align: center">
            <strong>S.No</strong>
            <% matkaUnsettled.slice().reverse().forEach((bet, index)=> { %>
            <li><%= index + 1 %></li>
            <% }) %>
          </ol>

          <!-- Game Name -->
          <ol class="col" style="flex: 2; text-align: center">
            <strong>Game Name</strong>
            <% matkaUnsettled.slice().reverse().forEach((bet)=> { %>
            <li><%= bet.matkaNo %></li>
            <% }) %>
          </ol>

          <!-- Event Name -->
          <ol class="col" style="flex: 2; text-align: center">
            <strong>Event Name</strong>
            <% matkaUnsettled.slice().reverse().forEach((bet)=> { %>
            <li><%= bet.gameName %></li>
            <% }) %>
          </ol>

          <!-- Selection -->
          <ol class="col" style="flex: 1; text-align: center">
            <strong>Selection</strong>
            <% matkaUnsettled.slice().reverse().forEach((bet)=> { %>
            <li style="color: skyblue"><%= bet.number %></li>
            <% }) %>
          </ol>

          <!-- Amount -->
          <ol class="col" style="flex: 1; text-align: center">
            <strong>Amount</strong>
            <% matkaUnsettled.slice().reverse().forEach((bet)=> { %>
            <li>₹<%= bet.amount %></li>
            <% }) %>
          </ol>

        
<ol class="col" style="flex: 2; text-align: center">
  <strong>Date & Time</strong>
  <% matkaUnsettled.slice().reverse().forEach(bet => { %>
    <li>
      <%= bet.createdAt.toLocaleString("en-IN", { 
            timeZone: "Asia/Kolkata", 
            hour12: true 
          }) %>
    </li>
  <% }) %>
</ol>


        </div>
      </div>
    </div>




<!-- Settled Section -->
<div id="settledSection" class="section">
  <div class="scroll-wrapper">
    <div class="scroll-row" style="display: flex; justify-content: space-between; gap:10px">

<ol class="col" style="flex:2; text-align:center">
  <strong>Date & Time</strong>
  <% allSettledBets.forEach(bet => { %>
    <li>
      <%= bet.createdAt.toLocaleString("en-IN", { 
            timeZone: "Asia/Kolkata", 
            hour12: true 
          }) %>
    </li>
  <% }) %>
</ol>


      <ol class="col" style="flex:2; text-align:center">
        <strong>Game Name</strong>
        <% allSettledBets.forEach(bet => { %>
          <li><%= bet.matkaNo || bet.coinGame %></li>
        <% }) %>
      </ol>

      <ol class="col" style="flex:2; text-align:center">
        <strong>Event Name</strong>
        <% allSettledBets.forEach(bet => { %>
          <li><%= bet.gameName %></li>
        <% }) %>
      </ol>

      <ol class="col" style="flex:1; text-align:center">
        <strong>Selection</strong>
        <% allSettledBets.forEach(bet => { %>
          <li style="color:skyblue"><%= bet.number || bet.userPick %></li>
        <% }) %>
      </ol>

      <ol class="col" style="flex:1; text-align:center">
        <strong>Amount</strong>
        <% allSettledBets.forEach(bet => { %>
          <li>₹<%= bet.amount %></li>
        <% }) %>
      </ol>

      <ol class="col" style="flex:1; text-align:center">
        <strong>Result</strong>
        <% allSettledBets.forEach(bet => { %>
          <li style="color:<%= bet.result === 'WIN' ? 'lightgreen' : 'red' %>">
            <%= bet.result %>
          </li>
        <% }) %>
      </ol>

      <ol class="col" style="flex:1; text-align:center">
        <strong>Profit</strong>
        <% allSettledBets.forEach(bet => { %>
          <li>
            <%= bet.profit >= 0 ? "₹" + bet.profit : "-₹" + Math.abs(bet.profit) %>
          </li>
        <% }) %>
      </ol>

    </div>
  </div>
</div>

    <!-- =================================== Footer Start ============================== -->
    <%- include('partials/footer') %>
<script>
function getHistory() {
  const dataSource = document.getElementById("dataSource").value;
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  const params = new URLSearchParams();

  // 1️⃣ Manual dates ALWAYS win
  if (start && end) {
    params.set("start", start);
    params.set("end", end);
  }
  // 2️⃣ If manual empty → source works
  else if (dataSource) {
    params.set("source", dataSource);
  }

  window.location.href = `/bets?${params.toString()}`;
}
</script>

<script>
document.querySelectorAll('input[type="date"]').forEach(input => {
  function update() {
    if (input.value) input.classList.add('has-value');
    else input.classList.remove('has-value');
  }
  update();
  input.addEventListener('change', update);
});
</script>

<script>
// FIX: dropdown select → clear manual date
document.getElementById("dataSource").addEventListener("change", () => {
  document.getElementById("startDate").value = "";
  document.getElementById("endDate").value = "";
  document.getElementById("startDate").classList.remove("has-value");
  document.getElementById("endDate").classList.remove("has-value");
});
</script>


  </body>
</html>
