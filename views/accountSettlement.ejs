<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matka  69</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 <link rel="stylesheet" href="/style.css" />   
<link rel="stylesheet" href="/css/bets.css" /> 
    <link rel="stylesheet" href="/css/headerlogin.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/adminDasebord.css">
     <link rel="stylesheet" href="/css/accountStatement.css">
     <link rel="stylesheet" href="/css/dateTimemodal.css">


    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/rendomsidebar.js"></script>
    <script src="/js/betbox.js"></script>
    <script src="/js/footer.js"></script>
</head>
<body>

    
    <!-- ==================================================Header======================================= -->


<%- include('partials/header') %>

   <div class="header"></div>  <!-- ========================= overflow header solve -->

<!--  ================================== Body Start ================================ -->

<body>

     <!-- Data Source Dropdown -->
  <select class="custom-input text-gray-600" id="dataSource">
    <option value="" disabled <%= !source ? "selected" : "" %>>Data Source</option>
    <option value="live"   <%= source === "live" ? "selected" : "" %>>Live Data (24H)</option>
    <option value="backup" <%= source === "backup" ? "selected" : "" %>>Backup Data (7 Days)</option>
    <option value="old"    <%= source === "old" ? "selected" : "" %>>Old Data (30 Days)</option>
  </select>

<input type="date" class="custom-input" id="startDate"
  data-placeholder="Start Date"
  value="<%= start || '' %>">

<input type="date" class="custom-input" id="endDate"
  data-placeholder="End Date"
  value="<%= end || '' %>">


  <!-- Button -->
  <button class="btn-history" onclick="getHistory()">
    Get History
  </button>
</div>



</body>
</html>

  <!-- ==================================================================== Table =================================== -->

<div class="bbody">

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Date & Time</th>
          <th>Deposite</th>
          <th>Withdrawal</th>
          <th>Avalable Balance</th>
          <th>From -> To</th>
        </tr>
      </thead>
<tbody>
  <% if (history.length === 0) { %>
    <tr>
      <td colspan="5" style="text-align:center;">No records found</td>
    </tr>
  <% } %>

  <% history.forEach(h => { %>
    <tr>
      <td><%= h.formattedDate %> & <%= h.formattedTime %></td>

      <% if (h.type === "deposit") { %>
        <td style="color:green;"><%= h.amount %></td>
        <td>0</td>
      <% } else { %>
        <td>0</td>
        <td style="color:red;">-<%= h.amount %></td>
      <% } %>

      <td><%= h.userWalletAfter %></td>

      <td>
        <% if (h.type === "deposit") { %>
          Upline → <%= user.username %>
        <% } else { %>
          <%= user.username %> → Upline
        <% } %>
      </td>
    </tr>
  <% }) %>
</tbody>

    </table>
  </div>

  <div class="pagination">
    <button disabled>Prev</button>
    <button class="active">1</button>
    <button>Next</button>
  </div>

</div>

   
<!-- =================================== Footer Start ============================== -->
 <%- include('partials/adminFooter') %>
    <script>
function getHistory() {
  const dataSource = document.getElementById("dataSource").value;
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;

  const params = new URLSearchParams();

  // 1️⃣ Manual dates ALWAYS win
  if (start && end) {
    params.set("start", start);
    params.set("end", end);
  }
  // 2️⃣ If manual empty → source works
  else if (dataSource) {
    params.set("source", dataSource);
  }

  const userId = "<%= user._id %>";
window.location.href = `/accountsettlement/${userId}?${params.toString()}`;
}
</script>

<script>
document.querySelectorAll('input[type="date"]').forEach(input => {
  function update() {
    if (input.value) input.classList.add('has-value');
    else input.classList.remove('has-value');
  }
  update();
  input.addEventListener('change', update);
});
</script>

<script>
// FIX: dropdown select → clear manual date
document.getElementById("dataSource").addEventListener("change", () => {
  document.getElementById("startDate").value = "";
  document.getElementById("endDate").value = "";
  document.getElementById("startDate").classList.remove("has-value");
  document.getElementById("endDate").classList.remove("has-value");
});
</script>
</body>
</html>